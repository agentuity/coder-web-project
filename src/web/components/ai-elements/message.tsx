import type { ComponentProps, HTMLAttributes } from 'react';
import { Button } from '../ui/button';
import { cn } from '../../lib/utils';

export type MessageProps = HTMLAttributes<HTMLDivElement> & {
	from: 'user' | 'assistant';
};

export const Message = ({ className, from, ...props }: MessageProps) => (
	<div
		className={cn(
			'group flex w-full max-w-[95%] flex-col gap-2',
			from === 'user' ? 'is-user ml-auto justify-end' : 'is-assistant',
			className
		)}
		{...props}
	/>
);

export type MessageContentProps = HTMLAttributes<HTMLDivElement>;

export const MessageContent = ({
	children,
	className,
	...props
}: MessageContentProps) => (
	<div
		className={cn(
			'flex w-fit min-w-0 max-w-full flex-col gap-2 overflow-hidden text-sm',
			'group-[.is-user]:ml-auto group-[.is-user]:rounded-lg group-[.is-user]:bg-[var(--secondary)] group-[.is-user]:px-4 group-[.is-user]:py-3 group-[.is-user]:text-[var(--foreground)]',
			'group-[.is-assistant]:text-[var(--foreground)]',
			className
		)}
		{...props}
	>
		{children}
	</div>
);

export type MessageActionsProps = ComponentProps<'div'>;

export const MessageActions = ({
	className,
	children,
	...props
}: MessageActionsProps) => (
	<div className={cn('flex items-center gap-1', className)} {...props}>
		{children}
	</div>
);

export type MessageActionProps = ComponentProps<typeof Button> & {
	tooltip?: string;
	label?: string;
};

export const MessageAction = ({
	tooltip,
	children,
	label,
	variant = 'ghost',
	className,
	...props
}: MessageActionProps) => (
	<Button
		className={cn('h-7 w-7', className)}
		size="icon"
		type="button"
		variant={variant}
		title={tooltip ?? label}
		{...props}
	>
		{children}
		<span className="sr-only">{label || tooltip}</span>
	</Button>
);

export type MessageResponseProps = HTMLAttributes<HTMLDivElement>;

export const MessageResponse = ({
	className,
	children,
	...props
}: MessageResponseProps) => (
	<div
		className={cn(
			'size-full [&>*:first-child]:mt-0 [&>*:last-child]:mb-0',
			className
		)}
		{...props}
	>
		{children}
	</div>
);

export type MessageToolbarProps = ComponentProps<'div'>;

export const MessageToolbar = ({
	className,
	children,
	...props
}: MessageToolbarProps) => (
	<div
		className={cn('mt-4 flex w-full items-center justify-between gap-4', className)}
		{...props}
	>
		{children}
	</div>
);
